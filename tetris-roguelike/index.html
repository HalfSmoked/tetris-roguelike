<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>方块命运 - Tetris Roguelike</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 开始界面 -->
    <div id="start-screen" class="screen">
        <h1>方块命运</h1>
        <p class="subtitle">俄罗斯方块 × Roguelike</p>
        <div class="mode-buttons">
            <button id="btn-start-single" class="btn-primary">单人模式</button>
            <button id="btn-start-pk" class="btn-primary btn-pk">本地双人</button>
            <button id="btn-start-online" class="btn-primary btn-online">在线对战</button>
        </div>
        <div class="controls-hint">
            <p><strong>单人/在线:</strong> ← → 移动 · ↑ 旋转 · ↓ 硬降 · Space 硬降 · C 暂存 · P 暂停</p>
            <p><strong>本地 P1:</strong> A D 移动 · W 旋转 · S/Space 硬降 · Shift 暂存</p>
            <p><strong>本地 P2:</strong> ← → 移动 · ↑ 旋转 · ↓ 硬降 · Num0 暂存</p>
        </div>
    </div>

    <!-- 单人游戏界面 -->
    <div id="game-screen" class="screen hidden">
        <div class="game-layout">
            <div class="side-panel left-panel">
                <div class="panel-box">
                    <h3>暂存</h3>
                    <canvas id="hold-canvas" width="100" height="100"></canvas>
                </div>
                <div class="panel-box">
                    <h3>已选词条</h3>
                    <div id="active-traits"></div>
                </div>
            </div>
            <div class="game-main">
                <canvas id="game-canvas"></canvas>
            </div>
            <div class="side-panel right-panel">
                <div class="panel-box">
                    <h3>下一个</h3>
                    <div id="next-pieces"></div>
                </div>
                <div class="panel-box">
                    <h3>分数</h3>
                    <div id="score" class="stat-value">0</div>
                </div>
                <div class="panel-box">
                    <h3>等级</h3>
                    <div id="level" class="stat-value">1</div>
                </div>
                <div class="panel-box">
                    <h3>消除行数</h3>
                    <div id="lines" class="stat-value">0</div>
                </div>
                <div class="panel-box progress-box">
                    <h3>下次词条</h3>
                    <div class="progress-bar">
                        <div id="trait-progress" class="progress-fill"></div>
                    </div>
                    <div id="trait-progress-text">0 / 10</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 双人PK游戏界面 -->
    <div id="pk-game-screen" class="screen hidden">
        <div class="pk-layout">
            <!-- 玩家1 -->
            <div class="pk-player p1">
                <h2 class="pk-player-label p1-color">玩家1</h2>
                <div class="pk-player-content">
                    <div class="pk-side">
                        <div class="panel-box">
                            <h3>暂存</h3>
                            <canvas id="pk-hold-canvas-p1" width="100" height="100"></canvas>
                        </div>
                        <div class="panel-box">
                            <h3>下一个</h3>
                            <div id="pk-next-pieces-p1"></div>
                        </div>
                        <div class="panel-box">
                            <h3>分数</h3>
                            <div id="pk-score-p1" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>等级</h3>
                            <div id="pk-level-p1" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>行数</h3>
                            <div id="pk-lines-p1" class="stat-value">0</div>
                        </div>
                        <div class="panel-box progress-box">
                            <h3>词条进度</h3>
                            <div class="progress-bar">
                                <div id="pk-trait-progress-p1" class="progress-fill"></div>
                            </div>
                            <div id="pk-trait-progress-text-p1">0 / 10</div>
                        </div>
                    </div>
                    <div class="pk-board">
                        <canvas id="pk-canvas-p1"></canvas>
                    </div>
                    <div class="pk-traits-panel">
                        <div class="panel-box">
                            <h3>已选词条</h3>
                            <div id="pk-active-traits-p1"></div>
                        </div>
                    </div>
                </div>
                <!-- 玩家1词条选择遮罩 -->
                <div id="pk-trait-overlay-p1" class="pk-player-overlay hidden">
                    <div class="pk-player-trait-modal">
                        <h2>选择词条</h2>
                        <p class="trait-hint"><span class="p1-color">玩家1</span> 请选择一个词条</p>
                        <div id="pk-trait-choices-p1" class="trait-choices trait-choices-vertical"></div>
                    </div>
                </div>
            </div>

            <!-- VS分隔 -->
            <div class="pk-vs">
                <span>VS</span>
            </div>

            <!-- 玩家2 -->
            <div class="pk-player p2">
                <h2 class="pk-player-label p2-color">玩家2</h2>
                <div class="pk-player-content">
                    <div class="pk-traits-panel">
                        <div class="panel-box">
                            <h3>已选词条</h3>
                            <div id="pk-active-traits-p2"></div>
                        </div>
                    </div>
                    <div class="pk-board">
                        <canvas id="pk-canvas-p2"></canvas>
                    </div>
                    <div class="pk-side">
                        <div class="panel-box">
                            <h3>暂存</h3>
                            <canvas id="pk-hold-canvas-p2" width="100" height="100"></canvas>
                        </div>
                        <div class="panel-box">
                            <h3>下一个</h3>
                            <div id="pk-next-pieces-p2"></div>
                        </div>
                        <div class="panel-box">
                            <h3>分数</h3>
                            <div id="pk-score-p2" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>等级</h3>
                            <div id="pk-level-p2" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>行数</h3>
                            <div id="pk-lines-p2" class="stat-value">0</div>
                        </div>
                        <div class="panel-box progress-box">
                            <h3>词条进度</h3>
                            <div class="progress-bar">
                                <div id="pk-trait-progress-p2" class="progress-fill"></div>
                            </div>
                            <div id="pk-trait-progress-text-p2">0 / 10</div>
                        </div>
                    </div>
                </div>
                <!-- 玩家2词条选择遮罩 -->
                <div id="pk-trait-overlay-p2" class="pk-player-overlay hidden">
                    <div class="pk-player-trait-modal">
                        <h2>选择词条</h2>
                        <p class="trait-hint"><span class="p2-color">玩家2</span> 请选择一个词条</p>
                        <div id="pk-trait-choices-p2" class="trait-choices trait-choices-vertical"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 在线大厅 -->
    <div id="online-lobby-screen" class="screen hidden">
        <h1 class="lobby-title">在线对战</h1>
        <div class="lobby-options">
            <div class="lobby-section">
                <button id="btn-create-room" class="btn-primary">创建房间</button>
                <div id="room-code-display" class="hidden">
                    <p class="lobby-label">房间代码</p>
                    <div id="room-code" class="room-code-text"></div>
                    <p class="lobby-hint">将此代码分享给你的朋友</p>
                </div>
            </div>
            <div class="lobby-divider">或</div>
            <div class="lobby-section">
                <p class="lobby-label">加入房间</p>
                <input id="join-code-input" type="text" maxlength="6" placeholder="输入房间代码" class="code-input">
                <button id="btn-join-room" class="btn-primary">加入</button>
            </div>
        </div>
        <div id="lobby-status" class="lobby-status hidden"></div>
        <button id="btn-lobby-back" class="btn-secondary" style="margin-top: 24px;">返回主菜单</button>
    </div>

    <!-- 在线游戏界面 -->
    <div id="online-game-screen" class="screen hidden">
        <div class="pk-layout">
            <!-- 本地玩家（左边） -->
            <div class="pk-player p1">
                <h2 class="pk-player-label p1-color">你</h2>
                <div class="pk-player-content">
                    <div class="pk-side">
                        <div class="panel-box">
                            <h3>暂存</h3>
                            <canvas id="ol-hold-canvas-local" width="100" height="100"></canvas>
                        </div>
                        <div class="panel-box">
                            <h3>下一个</h3>
                            <div id="ol-next-pieces-local"></div>
                        </div>
                        <div class="panel-box">
                            <h3>分数</h3>
                            <div id="ol-score-local" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>等级</h3>
                            <div id="ol-level-local" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>行数</h3>
                            <div id="ol-lines-local" class="stat-value">0</div>
                        </div>
                        <div class="panel-box progress-box">
                            <h3>词条进度</h3>
                            <div class="progress-bar">
                                <div id="ol-trait-progress-local" class="progress-fill"></div>
                            </div>
                            <div id="ol-trait-progress-text-local">0 / 10</div>
                        </div>
                    </div>
                    <div class="pk-board">
                        <canvas id="ol-canvas-local"></canvas>
                    </div>
                    <div class="pk-traits-panel">
                        <div class="panel-box">
                            <h3>已选词条</h3>
                            <div id="ol-active-traits-local"></div>
                        </div>
                    </div>
                </div>
                <!-- 本地玩家词条选择遮罩 -->
                <div id="ol-trait-overlay-local" class="pk-player-overlay hidden">
                    <div class="pk-player-trait-modal">
                        <h2>选择词条</h2>
                        <p class="trait-hint">选择一个词条</p>
                        <div id="ol-trait-choices-local" class="trait-choices trait-choices-vertical"></div>
                    </div>
                </div>
            </div>

            <!-- VS分隔 -->
            <div class="pk-vs">
                <span>VS</span>
            </div>

            <!-- 远程对手（右边） -->
            <div class="pk-player p2">
                <h2 class="pk-player-label p2-color">对手</h2>
                <div class="pk-player-content">
                    <div class="pk-traits-panel">
                        <div class="panel-box">
                            <h3>已选词条</h3>
                            <div id="ol-active-traits-remote"></div>
                        </div>
                    </div>
                    <div class="pk-board">
                        <canvas id="ol-canvas-remote"></canvas>
                    </div>
                    <div class="pk-side">
                        <div class="panel-box">
                            <h3>暂存</h3>
                            <canvas id="ol-hold-canvas-remote" width="100" height="100"></canvas>
                        </div>
                        <div class="panel-box">
                            <h3>下一个</h3>
                            <div id="ol-next-pieces-remote"></div>
                        </div>
                        <div class="panel-box">
                            <h3>分数</h3>
                            <div id="ol-score-remote" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>等级</h3>
                            <div id="ol-level-remote" class="stat-value">0</div>
                        </div>
                        <div class="panel-box">
                            <h3>行数</h3>
                            <div id="ol-lines-remote" class="stat-value">0</div>
                        </div>
                        <div class="panel-box progress-box">
                            <h3>词条进度</h3>
                            <div class="progress-bar">
                                <div id="ol-trait-progress-remote" class="progress-fill"></div>
                            </div>
                            <div id="ol-trait-progress-text-remote">0 / 10</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 在线游戏结束 -->
    <div id="online-gameover-screen" class="overlay hidden">
        <div class="gameover-modal pk-gameover-modal">
            <h2 id="ol-winner">你赢了!</h2>
            <div class="pk-final-stats">
                <div class="pk-final-col">
                    <h3 class="p1-color">你</h3>
                    <div class="stat-row"><span>分数</span><span id="ol-final-score-local">0</span></div>
                    <div class="stat-row"><span>行数</span><span id="ol-final-lines-local">0</span></div>
                    <div class="stat-row"><span>等级</span><span id="ol-final-level-local">0</span></div>
                </div>
                <div class="pk-final-col">
                    <h3 class="p2-color">对手</h3>
                    <div class="stat-row"><span>分数</span><span id="ol-final-score-remote">0</span></div>
                    <div class="stat-row"><span>行数</span><span id="ol-final-lines-remote">0</span></div>
                    <div class="stat-row"><span>等级</span><span id="ol-final-level-remote">0</span></div>
                </div>
            </div>
            <div class="pk-gameover-buttons">
                <button id="btn-ol-back-menu" class="btn-secondary">返回主菜单</button>
            </div>
        </div>
    </div>

    <!-- 在线断连通知 -->
    <div id="online-disconnect-screen" class="overlay hidden">
        <div class="pause-modal">
            <h2>对手已断开连接</h2>
            <button id="btn-ol-disconnect-back" class="btn-primary">返回主菜单</button>
        </div>
    </div>

    <!-- 单人词条选择 -->
    <div id="trait-screen" class="overlay hidden">
        <div class="trait-modal">
            <h2>选择词条</h2>
            <p class="trait-hint">消除了10行！选择一个词条增强你的能力</p>
            <div id="trait-choices" class="trait-choices"></div>
        </div>
    </div>

    <!-- 暂停 -->
    <div id="pause-screen" class="overlay hidden">
        <div class="pause-modal">
            <h2>暂停</h2>
            <button id="btn-resume" class="btn-primary">继续游戏</button>
        </div>
    </div>

    <!-- 单人游戏结束 -->
    <div id="gameover-screen" class="overlay hidden">
        <div class="gameover-modal">
            <h2>游戏结束</h2>
            <div class="final-stats">
                <div class="stat-row"><span>最终分数</span><span id="final-score">0</span></div>
                <div class="stat-row"><span>消除行数</span><span id="final-lines">0</span></div>
                <div class="stat-row"><span>最终等级</span><span id="final-level">0</span></div>
            </div>
            <div id="final-traits"></div>
            <button id="btn-restart" class="btn-primary">再来一局</button>
        </div>
    </div>

    <!-- 双人游戏结束 -->
    <div id="pk-gameover-screen" class="overlay hidden">
        <div class="gameover-modal pk-gameover-modal">
            <h2 id="pk-winner">玩家1 获胜!</h2>
            <div class="pk-final-stats">
                <div class="pk-final-col">
                    <h3 class="p1-color">玩家1</h3>
                    <div class="stat-row"><span>分数</span><span id="p1-final-score">0</span></div>
                    <div class="stat-row"><span>行数</span><span id="p1-final-lines">0</span></div>
                    <div class="stat-row"><span>等级</span><span id="p1-final-level">0</span></div>
                </div>
                <div class="pk-final-col">
                    <h3 class="p2-color">玩家2</h3>
                    <div class="stat-row"><span>分数</span><span id="p2-final-score">0</span></div>
                    <div class="stat-row"><span>行数</span><span id="p2-final-lines">0</span></div>
                    <div class="stat-row"><span>等级</span><span id="p2-final-level">0</span></div>
                </div>
            </div>
            <div class="pk-gameover-buttons">
                <button id="btn-pk-restart" class="btn-primary">再来一局</button>
                <button id="btn-back-menu" class="btn-secondary">返回主菜单</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
    <script src="traits.js"></script>
    <script src="ui.js"></script>
    <script src="network.js"></script>
    <script src="remote-renderer.js"></script>
    <script src="main.js"></script>
</body>
</html>
